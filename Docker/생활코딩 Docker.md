### 1. 수업소개

서비스를 만들기 위해서는 여러 소프트웨어를 설치해야 하는데,

여간 까다롭고 귀찮다. 한 번에 되는 경우가 없다.

하나의 컴퓨터에 가상으로 컴퓨터를 만들고 거기에 윕서버, 디비를 운영하면 어떨까?

이게 바로 가상 컴퓨터에요.

그런데 웹서버 하나 때문에 운영체제 설치하기가 너무 아깝죠.

운영체제 위에 운영체제가 운영되니, 실행속도도 느리고 운영체제 자체의 용량도 거대합니다. 비효율적이죠.

우리는 다시 이런 꿈을 꿉니다.

하나의 컴퓨터에서 각각의 앱을 실행하면 어떨까, 그것도 각 격리된 상황에서!

이 때 운영체제게 설치된 컴퓨터를 호스트 라고 부르고, 호스트에서 실행된 실행 환경을 컨테이너라고 부릅시다.

각각의 컨테이너에는 운영체제가 아닌 앱을 실행하는데 필요한 라이브러리와 실행파일만 있습니다.

운영체제는 단 하나이고, 파일 용량도 줄어드니 속도도 빠르고 효율적이겠죠. 이게 가능할까요?

리눅스 운영체제에는 이런 환상적인 운영방법이 내장되어 있습니다.

이러한 기술을 컨테이너라고 부릅니다. 컨테이너 기술을 이용해 이를 쉽게 해주는 소프트웨어가 많은데 그 중 하나가 도커입니다.

도커는, 부두에서 컨테이너를 다루는 노동자들을 의미합니다. 

도커 수업을 지금부터 시작하겠습니다.

도커를 이용하는 원리를 알아봅시다!!

### 2. 설치

알아야 할 것이 몇 개 있다.

컨테이너 기술은 리눅스 운영체제의 기술이다.

1. 도커위에서 돌아가는 컨테이너, 또 컨테이너 안에서 돌아가는 앱들은 리눅스 운영체제에서 동작하는 앱들이다.
2. 자신의 컴퓨터가 리눅스 운영체제가 아니면 도커 못쓴다?
    
    아니다! 우리 컴퓨터에 가상머신을 깔고 리눅스 운영체제를 깔면 그 위에서 도커와 같은 컨테이너 기술을 사용할 수 있게 된다.
    
    그런데, 복잡하고 까다로워 보이지? 괜찮다. 도커가 알아서 가상머신도 만들고 그 위에 리눅스도 설치해 준다.
    

docker.com에서 설치를 합니다.

설치후 터미널에서 `docker imges`를 실행했을 때 에러가 안난다면 잘 설치되었다는 의미입니다.

### 3. 이미지 pull

어플을 어디서 받나요? 앱스토어에서 받죠.

마찬가지로 도커의 소프트웨어는 `docker hub`에서 찾게 될겁니다.

앱스토에서 받아온건 프로그램이라 하죠.

도커 허브에서 다운받은건 `이미지` 라고 합니다.

프로그램을 실행하면 프로세스가 실행되는데요.

이미지를 실행하는 것을 `컨테이너`라고 합니다.

프로그램이 여러개의 프로세스를 가질 수 있는 것처럼

이미지도 여러개의 컨테이너를 가질 수 있습니다. 

이미지를 도커허브에서 다운받는 행위를 `pull`이라고 합니다.

이미지를 실행시키는 행위를 `run`이라고 합니다.

`run` 을 하면 이미지가 컨테이너가 되고 

컨테이너가 실행되면서 안에 포함된 실행되도록 배치된 프로그램들이 실행됩니다.

- 이미지 pull 하기

이미지를 pull 하는 방법을 배워봅시다.

[hub.docker.com](http://hub.docker.com) 에 들어갑니다. 

메뉴에 Explore라는 버튼을 클릭하고 Containers를 클릭합니다. 

그러면 인기있는 컨테이너들이 나옵니다. 

httpd라는 이미지를 찾아봅시다.

이 녀석이 아파치 웹서버입니다. OFFICAL IMAGE는 도커에서 인증하는 공식 이미지라는 의미입니다. 

클릭하면 이런 명령어를 안내 받습니다.

`docker pull httpd` 이 명령어로 httpd 이미지를 pull 할 수 있습니다. 

docs.docker.com에 들어가면 도커 공식 문서를 볼 수 있습니다.

여기서 상단바 Reference에 들어가봅시다.  

Command-line reference에서 Docker CLI를 클릭하면 

docker pull이라는 명령어가 있어요. 여기에 형식이 나옵니다. 

docker pull [OPTIONS] NAME[:TAG] 

- 이미지 pull 확인하기

이미지를 잘 pull했는지 확인하기 위해서는 이미지스를 사용하면 됩니다.

`docker images` 를 터미널에 입력하면 버전, 이미지, 용량이 표현됩니다.

docker images [OPTIONS] [REPOSITORY[:TAG]]

이런 작업을 GUI에서 하고 싶다면,

도커 대쉬보드에 들어갑시다.

images를 클릭하면 이미지 설치 여부를 확인할 수 있습니다. 

### 4. 컨테이너 run

[https://www.youtube.com/watch?v=iLcUr0EQdrM&list=PLuHgQVnccGMDeMJsGq2O-55Ymtx0IdKWf&index=4](https://www.youtube.com/watch?v=iLcUr0EQdrM&list=PLuHgQVnccGMDeMJsGq2O-55Ymtx0IdKWf&index=4)

RUN || START

이미지를 실행시켜 컨테이너를 만드는 행위를 RUN이라고 한다.

실행 되고 있는 컨테이너는 컴퓨터의 자원을 사용합니다.

자원을 아끼기 위해서는 컨테이너를 종료할 필요가 있습니다. 

STOP

컨테이너를 끕니다.

DELETE

컨테이너를 삭제합니다. 

**이걸 커맨드에서 해봅시다.** 

[docker run] (실행)

`docker run [OPTIONS] IMAGE [COMMAND] [ARG...]`

[OPTIONS]에는 여러가지 속성이 있는데, 

대표적인게 이름을 정하는 속성이에요. 예를들어

`docker run —name hello httpd`

hello 라는 이름으로 httpd이미지를 실행하는 겁니다. 

실행중인 컨테이너 확인

`docker ps` Up은 실행중이라는 의미입니다!

`docker ps -a` 를 통해 운영하지 않는 컨테이너들도 확인 가능해요!

[docekr stop] (종료)

`docker stop [OPTIONS} CONTAINER [CONTAINER...]`

CONTAINER 자리에 종료할 컨테이너의 아이디나 이름을 입력하면 됩니다. 

[docker logs] (로그 확인하기)

`docker logs [CONTAINER]` 컨테이너의 로그를 확인합니다. 

`docker logs -f [CONTAINER]` 실시간으로 컨테이너의 로그를 확인합니다. 

[docker rm] (컨테이너 삭제하기)

`docker rm [CONTAINER]` 실행중인 컨테이너는 삭제되지 않습니다!

`docker rm —-force [CONTAINER]`를 하면 스탑을 안해도 삭제가 됩니다.

[docker rmi] (이미지 삭제)

docker images 로 이미지 ls를 확인하고

`docker rmi [CONTAINER]`  이미지 확인후 삭제가 가능합니다! (확인은 말 그대로 확인을 위해서에요!)

### 5. 네트워크

docker 없이 웹서버를 사용하는 방법 

1. 2대의 컴퓨터가 필요합니다. 하나는 웹 브라우저, 하나는 웹서버
2. 서버컴퓨터에 파일시스템 내에 index.html을 위치합니다.
3. 그리고 이에 접속할 수 있는 Port를 열어줍니다. 80번 포트를 이용한다고 합시다.(아파치가 실제로 그래요)
4. 웹서버에 들어가는 주소는 hello.com입니다.
5. 이제 브라우저 컴퓨터에서 [hello.com/index.html을](http://hello.com/index.html을) 입력하여 접속을 시도합니다. 
6. 브라우저는 hello.com에 접속해서 80번 포트에 접속해서 웹서버에서 요청을 하고 웹서버는 idnex.html을 찾습니다. 이를 읽어서 웹서버는 웹브라우저에게 파일을 전달합니다.

docker로 사용해봅시다.

1. docker run httpd로 웹서버를 실행하면, 웹서버가 컨테이너에 위치합니다. 
2. 컨테이너가 된 운영체제를 뭐라고 부를까요? 바로 docker Host라고 부릅니다.
3. docker Host 안에서는 여러개의 컨테이너가 실행될 수 있습니다.  
4. Host랑 컨테이너는 각각의 파일 시스템을 갖고 있습니다.
5. 접속을 시도해봅시다. 안됩니다. 왜? 컨테이너와 호스트의 연결이 끊겨 있기 때문입니다.  어떻게 연결할까요?
6. 컨테이너를 이렇게 실행을 합니다. `docker run -p 80:80 httpd`
7. 그러면 호스트와 컨테이너가 연결됩니다. 앞의 80은 호스트 뒤에 80은 컨테이너입니다. 
8. 이렇게 연결하는 신호방식을 포트 포워딩(port forwarding)이라고 합니다. 

**컨테이너 run 때 포트를 지정하는 방법**

`docker run —name hi -p 8080:80 httpd`

httpd 이미지를 hi 라는 이름으로 8080포트로 접속하면 80번 포트로 연결하여 컨테이너 실행!

### 6. 명령어 실행

`docker exec [OPTIONS] CONTAINER COMMANT [ARG...]`

예)

`docker exec ws3`  +   pwd

ws3 컨테이너에서 pwd 명령 실행

`docker exec ws3`  +   ls

ws3 컨테이너에서 ls 명령 실행

지속적으로 명령을 내리고 싶다면?

`docker exec ws3 /bin/sh`

본쉘이라는 프로그램을 실행합니다.  쉘은 사용자가 입력한 명령어를 운영체제에게 전달하는 역할입니다.

실행 하면, 아무런 반응이 없습니다. 

왜냐하면 실행하자마자 꺼졌기 때문이죠.

그래서, 이렇게 실행해 봅시다.

`docker exec -it ws3 /bin/sh`

그 후에 사용하는 모든 명령어는 ws3 안에서 실행됩니다. 

연결도 끊어야겠죠?

`exit` 를 명령하면 됩니다.

`docker exec -it ws3 /bin/bash` 

이렇게 하면 본쉘이 아닌 배쉬쉘이 실행됩니다 참고하세요!

### 7. 호스트와 컨테이너의 파일시스템 연결

컨테이너 안에서 파일을 작업하는데,

만약 컨테이너가 종료된다면? 혹은 삭제된다면

지금까지 했던 세팅이 다 날라가겠죠.

그렇다면 호스트에서 작성한 파일이

컨테이너와 연결되어 바로 반영된다면 얼마나 좋을까요?

컨테이너가 날라가도 소스코드는 남아있으니 안전하죠.

또한 버전 관리도 쉬울겁니다. 

필요시 참고하기!